(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};window.BaseGraph=function(){function e(e,i){return this.setYAxisPosition=t(this.setYAxisPosition,this),this.setXAxisPosition=t(this.setXAxisPosition,this),this.onResize=t(this.onResize,this),this.setupMarkerLabel=t(this.setupMarkerLabel,this),this.setupMarkerLine=t(this.setupMarkerLine,this),this.id=e,this.options=$.extend(!0,{},n,i),this.$el=$("#"+this.id),this.getDimensions(),this.setSVG(),this.setScales(),this.markers=[],this}var i,n;return n={margin:{top:0,right:0,bottom:20,left:0},aspectRatio:.5625,label:!1,legend:!1,mouseEvents:!0,key:{id:"key",x:"key",y:"value"}},i={value:null,label:"",orientation:"horizontal",align:"right"},e.prototype.setSVG=function(){return this.svg=d3.select("#"+this.id).append("svg").attr("width",this.containerWidth).attr("height",this.containerHeight),this.container=this.svg.append("g").attr("transform","translate("+this.options.margin.left+","+this.options.margin.top+")")},e.prototype.loadData=function(t){return d3.csv(t,function(t){return function(e,i){return t.$el.trigger("data-loaded"),t.setData(i)}}(this)),this},e.prototype.setData=function(t){return this.data=this.dataParser(t),this.drawScales(),this.options.legend&&this.drawLegend(),this.drawMarkers(),this.drawGraph(),this.$el.trigger("draw-complete"),this},e.prototype.dataParser=function(t){return t},e.prototype.setGraph=function(){return this},e.prototype.setScales=function(){return this},e.prototype.drawScales=function(){return this.x.domain(this.getScaleXDomain()),this.y.domain(this.getScaleYDomain()),this.xAxis&&this.container.append("g").attr("class","x axis").call(this.setXAxisPosition).call(this.xAxis),this.yAxis&&this.container.append("g").attr("class","y axis").call(this.setYAxisPosition).call(this.yAxis),this},e.prototype.getScaleXRange=function(){return[0,this.width]},e.prototype.getScaleYRange=function(){return[this.height,0]},e.prototype.getScaleXDomain=function(){return[]},e.prototype.getScaleYDomain=function(){return[]},e.prototype.drawLegend=function(){return this},e.prototype.addMarker=function(t){return this.markers.push($.extend({},i,t)),this},e.prototype.drawMarkers=function(){return this.container.selectAll(".marker").data(this.markers).enter().append("line").attr("class","marker").call(this.setupMarkerLine),this.container.selectAll(".marker-label").data(this.markers).enter().append("text").attr("class","marker-label").attr("text-anchor",function(t){return"vertical"===t.orientation?"middle":"right"===t.align?"end":"start"}).attr("dy",function(t){return"horizontal"===t.orientation?"-0.25em":0}).text(function(t){return t.label}).call(this.setupMarkerLabel)},e.prototype.setupMarkerLine=function(t){return t.attr("x1",function(t){return function(e){return"horizontal"===e.orientation?0:t.x(e.value)}}(this)).attr("y1",function(t){return function(e){return"horizontal"===e.orientation?t.y(e.value):0}}(this)).attr("x2",function(t){return function(e){return"horizontal"===e.orientation?t.width:t.x(e.value)}}(this)).attr("y2",function(t){return function(e){return"horizontal"===e.orientation?t.y(e.value):t.height}}(this))},e.prototype.setupMarkerLabel=function(t){return t.attr("x",function(t){return function(e){return"horizontal"===e.orientation?"right"===e.align?t.width:0:t.x(e.value)}}(this)).attr("y",function(t){return function(e){return"horizontal"===e.orientation?t.y(e.value):t.height}}(this))},e.prototype.onResize=function(){return this.getDimensions(),this.updateGraphDimensions(),this},e.prototype.getDimensions=function(){return this.$el&&(this.containerWidth=this.$el.width(),this.containerHeight=this.containerWidth*this.options.aspectRatio,this.width=this.containerWidth-this.options.margin.left-this.options.margin.right,this.height=this.containerHeight-this.options.margin.top-this.options.margin.bottom),this},e.prototype.updateGraphDimensions=function(){return this.svg&&this.svg.attr("width",this.containerWidth).attr("height",this.containerHeight),this.x&&this.x.range(this.getScaleXRange()),this.y&&this.y.range(this.getScaleYRange()),this.xAxis&&this.container.selectAll(".x.axis").call(this.setXAxisPosition).call(this.xAxis),this.yAxis&&this.container.selectAll(".y.axis").call(this.setYAxisPosition).call(this.yAxis),this.container.select(".marker").call(this.setupMarkerLine),this.container.select(".marker-label").call(this.setupMarkerLabel),this},e.prototype.setXAxisPosition=function(t){return t.attr("transform","translate(0,"+this.height+")")},e.prototype.setYAxisPosition=function(t){return t.attr("transform","translate("+this.width+",0)")},e.prototype.getDataX=function(){return d[this.options.key.x]},e.prototype.getDataY=function(){return d[this.options.key.y]},e}()}).call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;window.BarGraph=function(i){function n(e,i){return this.onMouseOut=t(this.onMouseOut,this),this.onMouseOver=t(this.onMouseOver,this),this.setBarLabelYDimensions=t(this.setBarLabelYDimensions,this),this.setBarLabelXDimensions=t(this.setBarLabelXDimensions,this),this.setBarDimensions=t(this.setBarDimensions,this),this.getScaleYDomain=t(this.getScaleYDomain,this),this.getScaleXDomain=t(this.getScaleXDomain,this),n.__super__.constructor.call(this,e,i),this}return e(n,i),n.prototype.dataParser=function(t){return t.forEach(function(t){return function(e){return e[t.options.key.y]=+e[t.options.key.y]}}(this)),t},n.prototype.setScales=function(){return this.x=d3.scaleBand().range(this.getScaleXRange()).paddingInner(.1).paddingOuter(0),this.y=d3.scaleLinear().range(this.getScaleYRange()),this},n.prototype.getScaleXDomain=function(){return this.data.map(function(t){return function(e){return e[t.options.key.x]}}(this))},n.prototype.getScaleYDomain=function(){return[0,d3.max(this.data,function(t){return function(e){return e[t.options.key.y]}}(this))]},n.prototype.drawGraph=function(){return this.container.selectAll(".bar").data(this.data).enter().append("rect").attr("class",function(t){return t.active?"bar active":"bar"}).attr("id",function(t){return function(e){return e[t.options.key.id]}}(this)).call(this.setBarDimensions),this.options.mouseEvents&&this.container.selectAll(".bar").on("mouseover",this.onMouseOver).on("mouseout",this.onMouseOut),this.options.label&&(this.container.selectAll(".bar-label-x").data(this.data).enter().append("text").attr("class",function(t){return t.active?"bar-label-x active":"bar-label-x"}).attr("id",function(t){return function(e){return"bar-label-x-"+e[t.options.key.id]}}(this)).attr("dy","1.25em").attr("text-anchor","middle").text(function(t){return function(e){return e[t.options.key.x]}}(this)).call(this.setBarLabelXDimensions),this.container.selectAll(".bar-label-y").data(this.data).enter().append("text").attr("class",function(t){return t.active?"bar-label-y active":"bar-label-y"}).attr("id",function(t){return function(e){return"bar-label-y-"+e[t.options.key.id]}}(this)).attr("dy","-0.5em").attr("text-anchor","middle").text(function(t){return function(e){return t.options.label.format?t.options.label.format(e[t.options.key.y]):e[t.options.key.y]}}(this)).call(this.setBarLabelYDimensions)),this},n.prototype.updateGraphDimensions=function(){return n.__super__.updateGraphDimensions.call(this),this.container.selectAll(".bar").call(this.setBarDimensions),this.container.selectAll(".bar-label-x").call(this.setBarLabelXDimensions),this.container.selectAll(".bar-label-y").call(this.setBarLabelYDimensions),this},n.prototype.setBarDimensions=function(t){return t.attr("x",function(t){return function(e){return t.x(e[t.options.key.x])}}(this)).attr("y",function(t){return function(e){return t.y(e[t.options.key.y])}}(this)).attr("height",function(t){return function(e){return t.height-t.y(e[t.options.key.y])}}(this)).attr("width",this.x.bandwidth())},n.prototype.setBarLabelXDimensions=function(t){return t.attr("x",function(t){return function(e){return t.x(e[t.options.key.x])+.5*t.x.bandwidth()}}(this)).attr("y",function(t){return function(e){return t.height}}(this))},n.prototype.setBarLabelYDimensions=function(t){return t.attr("x",function(t){return function(e){return t.x(e[t.options.key.x])+.5*t.x.bandwidth()}}(this)).attr("y",function(t){return function(e){return t.y(e[t.options.key.y])}}(this))},n.prototype.onMouseOver=function(t){return this.container.select("#bar-label-x-"+t[this.options.key.id]).classed("active",!0),this.container.select("#bar-label-y-"+t[this.options.key.id]).classed("active",!0)},n.prototype.onMouseOut=function(t){if(!t.active)return this.container.select("#bar-label-x-"+t[this.options.key.id]).classed("active",!1),this.container.select("#bar-label-y-"+t[this.options.key.id]).classed("active",!1)},n}(window.BaseGraph)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;window.LineGraph=function(i){function n(e,i){return this.setTickHoverPosition=t(this.setTickHoverPosition,this),this.setLineLabelHoverPosition=t(this.setLineLabelHoverPosition,this),this.onMouseMove=t(this.onMouseMove,this),this.onMouseOut=t(this.onMouseOut,this),this.setOverlayDimensions=t(this.setOverlayDimensions,this),this.setLabelDimensions=t(this.setLabelDimensions,this),this.getScaleXDomain=t(this.getScaleXDomain,this),n.__super__.constructor.call(this,e,i),this}return e(n,i),n.prototype.yFormat=d3.format("d"),n.prototype.setData=function(t){return this.years=this.getYears(t),n.__super__.setData.call(this,t),this},n.prototype.getYears=function(t){var e;return e=[],d3.keys(t[0]).forEach(function(t){if(+t)return e.push(+t)}),e.sort()},n.prototype.dataParser=function(t){return t.forEach(function(t){return function(e){return e.values={},t.years.forEach(function(t){return e[t]&&(e.values[t]=+e[t]),delete e[t]})}}(this)),t},n.prototype.setScales=function(){return this.x=d3.scaleLinear().range(this.getScaleXRange()),this.y=d3.scaleLinear().range(this.getScaleYRange()),this.xAxis=d3.axisBottom(this.x).tickFormat(d3.format("")),this.yAxis=d3.axisLeft(this.y).tickSize(this.width),this.line=d3.line().curve(d3.curveCatmullRom).x(function(t){return function(e){return t.x(+e.key)}}(this)).y(function(t){return function(e){return t.y(e.value)}}(this)),this.options.isArea&&(this.area=d3.area().curve(d3.curveCatmullRom).x(function(t){return function(e){return t.x(+e.key)}}(this)).y0(this.height).y1(function(t){return function(e){return t.y(e.value)}}(this))),this},n.prototype.getScaleXDomain=function(){return[this.years[0],this.years[this.years.length-1]]},n.prototype.getScaleYDomain=function(){return[0,d3.max(this.data,function(t){return d3.max(d3.values(t.values))})]},n.prototype.drawGraph=function(){return this.container.select(".graph").remove(),this.graph=this.container.append("g").attr("class","graph"),this.drawLines(),this.options.isArea&&this.drawAreas(),this.options.label&&this.drawLabels(),this.options.mouseEvents&&(this.drawLineLabelHover(),this.drawRectOverlay()),this},n.prototype.updateGraphDimensions=function(){return n.__super__.updateGraphDimensions.call(this),this.options.isArea&&this.area.y0(this.height),this.yAxis.tickSize(this.width),this.container.selectAll(".line").attr("d",this.line),this.options.isArea&&this.container.selectAll(".area").attr("d",this.area),this.options.label&&this.container.selectAll(".line-label").call(this.setLabelDimensions),this.options.mouseEvents&&(this.container.select(".overlay").call(this.setOverlayDimensions),this.container.select(".tick-hover").call(this.setTickHoverPosition)),this},n.prototype.drawLines=function(){return this.graph.selectAll(".line").data(this.data).enter().append("path").attr("class","line").attr("id",function(t){return function(e){return"line-"+e[t.options.key.id]}}(this)).datum(function(t){return d3.entries(t.values)}).attr("d",this.line)},n.prototype.drawAreas=function(){return this.graph.selectAll(".area").data(this.data).enter().append("path").attr("class","area").attr("id",function(t){return function(e){return"area-"+e[t.options.key.id]}}(this)).datum(function(t){return d3.entries(t.values)}).attr("d",this.area)},n.prototype.drawLabels=function(){return this.graph.selectAll(".line-label").data(this.data).enter().append("text").attr("class","line-label").attr("id",function(t){return function(e){return"line-label-"+e[t.options.key.id]}}(this)).attr("text-anchor","end").attr("dy","-0.125em").text(function(t){return function(e){return e[t.options.key.x]}}(this)).call(this.setLabelDimensions)},n.prototype.drawLineLabelHover=function(){if(this.container.selectAll(".line-label-point").data(this.data).enter().append("circle").attr("id",function(t){return function(e){return"line-label-point-"+e[t.options.key.id]}}(this)).attr("class","line-label-point").attr("r",4).style("display","none"),this.container.append("text").attr("class","tick-hover").attr("dy","0.71em").style("display","none").call(this.setTickHoverPosition),1===this.data.length)return this.container.append("text").attr("class","line-label-hover").attr("text-anchor","middle").attr("dy","-0.5em").style("display","none")},n.prototype.drawRectOverlay=function(){return this.container.append("rect").attr("class","overlay").call(this.setOverlayDimensions).on("mouseover",this.onMouseMove).on("mouseout",this.onMouseOut).on("mousemove",this.onMouseMove)},n.prototype.setLabelDimensions=function(t){return t.attr("x",this.width).attr("y",function(t){return function(e){return t.y(e.values[t.years[t.years.length-1]])}}(this))},n.prototype.setOverlayDimensions=function(t){return t.attr("width",this.width).attr("height",this.height)},n.prototype.onMouseOut=function(t){return this.$el.trigger("mouseout"),this.hideLabel()},n.prototype.onMouseMove=function(t){var e,i;if(e=d3.mouse(d3.event.target),(i=Math.round(this.x.invert(e[0])))!==this.currentYear)return this.$el.trigger("change-year",i),this.setLabel(i)},n.prototype.setLabel=function(t){return this.currentYear=t,this.container.select(".x.axis").selectAll(".tick").style("display","none"),this.container.selectAll(".line-label-point").each(function(t){return function(e){return t.setLineLabelHoverPosition(e)}}(this)),this.container.select(".tick-hover").style("display","block").attr("x",Math.round(this.x(this.currentYear))).text(this.currentYear)},n.prototype.hideLabel=function(){return this.container.selectAll(".line-label-point").style("display","none"),this.container.selectAll(".line-label-hover").style("display","none"),this.container.select(".x.axis").selectAll(".tick").style("display","block"),this.container.select(".tick-hover").style("display","none")},n.prototype.setLineLabelHoverPosition=function(t){var e,i,n;for(n=this.currentYear;this.years.indexOf(n)===-1&&this.currentYear>this.years[0];)n--;return this.currentYear=n,i=d3.select("#line-label-point-"+t[this.options.key.id]),e=this.container.selectAll(".line-label-hover"),t.values[n]?(i.style("display","block"),e.style("display","block"),i.attr("cx",function(t){return function(e){return t.x(n)}}(this)).attr("cy",function(e){return function(i){return t.values[n]?e.y(t.values[n]):0}}(this)),e.attr("x",function(t){return function(e){return t.x(n)}}(this)).attr("y",function(e){return function(i){return t.values[n]?e.y(t.values[n]):0}}(this)).text(function(e){return function(i){return t.values[n]?e.yFormat(t.values[n]):""}}(this))):(i.style("display","none"),void e.style("display","none"))},n.prototype.setTickHoverPosition=function(t){return t.attr("y",Math.round(this.height+this.options.margin.top+9))},n}(window.BaseGraph)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;window.HeatmapGraph=function(i){function n(e,i){return this.getCountryName=t(this.getCountryName,this),this.onMouseOut=t(this.onMouseOut,this),this.onMouseOver=t(this.onMouseOver,this),this.setMarkerDimensions=t(this.setMarkerDimensions,this),this.setCellDimensions=t(this.setCellDimensions,this),this.getColorDomain=t(this.getColorDomain,this),this.getScaleYDomain=t(this.getScaleYDomain,this),this.getScaleXDomain=t(this.getScaleXDomain,this),this.getScaleYRange=t(this.getScaleYRange,this),this.getScaleXRange=t(this.getScaleXRange,this),n.__super__.constructor.call(this,e,i),this.formatFloat=d3.format(",.1f"),this.formatInteger=d3.format(",d"),this}return e(n,i),n.prototype.setSVG=function(){return this.svg=null,this.container=d3.select("#"+this.id+" .heatmap-graph"),this.options.legend&&this.container.classed("has-legend",!0),this.$tooltip=this.$el.find(".tooltip")},n.prototype.setData=function(t){return this.years=this.getYears(t),this.countries=t.map(function(t){return t.code}),this.cellsData=this.getCellsData(t),this.data=this.dataParser(t),this.getDimensions(),this.drawScales(),this.drawMarkers(),this.options.legend&&this.drawLegend(),this.drawGraph(),this},n.prototype.getYears=function(t){var e,i,n;return i=d3.min(t,function(t){return d3.min(d3.keys(t.values))}),e=d3.max(t,function(t){return d3.max(d3.keys(t.values))}),n=d3.range(i,e,1),n.push(+e),n},n.prototype.getCellsData=function(t){var e;return e=[],t.forEach(function(t){var i,n;i=[];for(n in t.values)i.push(e.push({country:t.code,name:t.name,year:n,cases:t.cases[n],value:t.values[n]}));return i}),e},n.prototype.dataParser=function(t){return t.forEach(function(t){return function(e){return e.values={},t.years.forEach(function(t){return e[t]&&(e.values[t]=+e[t]),delete e[t]})}}(this)),t},n.prototype.setScales=function(){return this.x=d3.scaleBand().padding(0).paddingInner(0).paddingOuter(0).round(!0).range(this.getScaleXRange()),this.y=d3.scaleBand().padding(0).paddingInner(0).paddingOuter(0).round(!0).range(this.getScaleYRange()),this.color=d3.scaleSequential(d3.interpolateOranges),this},n.prototype.drawScales=function(){return n.__super__.drawScales.call(this),this.color.domain(this.getColorDomain()),this},n.prototype.getScaleXRange=function(){return[0,this.width]},n.prototype.getScaleYRange=function(){return[0,this.height]},n.prototype.getScaleXDomain=function(){return this.years},n.prototype.getScaleYDomain=function(){return this.countries},n.prototype.getColorDomain=function(){return[0,400]},n.prototype.getDimensions=function(){var t;return this.width=this.$el.width()-70,this.years&&this.countries&&(t=Math.floor(this.width/this.years.length),t<15&&(t=15,this.width=t*this.years.length+70),this.height=t<20?t*this.countries.length:20*this.countries.length),this},n.prototype.drawGraph=function(){return this.x.range(this.getScaleXRange()),this.y.range(this.getScaleYRange()),this.container.append("div").attr("class","x-axis axis").selectAll(".axis-item").data(this.years.filter(function(t){return t%5==0})).enter().append("div").attr("class","axis-item").style("left",function(t){return function(e){return t.x(e)+"px"}}(this)).html(function(t){return t}),this.container.append("div").attr("class","y-axis axis").selectAll(".axis-item").data(this.countries).enter().append("div").attr("class","axis-item").style("top",function(t){return function(e){return t.y(e)+"px"}}(this)).html(function(t){return function(e){return t.getCountryName(e)}}(this)),this.container.append("div").attr("class","cell-container").style("height",this.height+"px").selectAll(".cell").data(this.cellsData).enter().append("div").attr("class","cell").style("background",function(t){return function(e){return t.color(e.value)}}(this)).on("mouseover",this.onMouseOver).on("mouseout",this.onMouseOut).call(this.setCellDimensions),this.container.select(".cell-container").selectAll(".marker").data(this.data.map(function(t){return{code:t.code,year:t.year_introduction}}).filter(function(t){return!isNaN(t.year)})).enter().append("div").attr("class","marker").call(this.setMarkerDimensions)},n.prototype.updateGraphDimensions=function(){return this.x.range(this.getScaleXRange()),this.y.range(this.getScaleYRange()),this.container.style("height",this.height+"px"),this.container.select(".cell-container").style("height",this.height+"px"),this.container.selectAll(".cell").call(this.setCellDimensions),this.container.select(".x-axis").selectAll(".axis-item").style("left",function(t){return function(e){return t.x(e)+"px"}}(this)),this.container.select(".y-axis").selectAll(".axis-item").style("top",function(t){return function(e){return t.y(e)+"px"}}(this)),this.container.select(".cell-container").selectAll(".marker").call(this.setMarkerDimensions),this},n.prototype.setCellDimensions=function(t){return t.style("left",function(t){return function(e){return t.x(e.year)+"px"}}(this)).style("top",function(t){return function(e){return t.y(e.country)+"px"}}(this)).style("width",this.x.bandwidth()+"px").style("height",this.y.bandwidth()+"px")},n.prototype.setMarkerDimensions=function(t){return t.style("top",function(t){return function(e){return t.y(e.code)-1+"px"}}(this)).style("left",function(t){return function(e){return e.year<t.years[0]?t.x(t.years[0])-1+"px":e.year<t.years[t.years.length-1]?t.x(e.year)-1+"px":t.x.bandwidth()+t.x(t.years[t.years.length-1])+"px"}}(this)).style("height",this.y.bandwidth()+1+"px")},n.prototype.onMouseOver=function(t){var e;e=$(d3.event.target).offset(),this.$tooltip.find(".tooltip-inner .country").html(t.name),this.$tooltip.find(".tooltip-inner .year").html(t.year),this.$tooltip.find(".tooltip-inner .value").html(0===t.value?0:this.formatFloat(t.value)),this.$tooltip.find(".tooltip-inner .cases").html(this.formatInteger(t.cases)),this.$tooltip.css({left:e.left+.5*this.x.bandwidth()-.5*this.$tooltip.width(),top:e.top-.5*this.y.bandwidth()-this.$tooltip.height(),opacity:"1"})},n.prototype.onMouseOut=function(t){this.$tooltip.css("opacity","0")},n.prototype.getCountryName=function(t){var e;return e=this.data.filter(function(e){return e.code===t}),e[0]?e[0].name:""},n.prototype.drawLegend=function(){var t;return t=[0,100,200,300,400],this.legend=this.container.append("ul").attr("class","legend").style("margin-left",-(15*t.length)+"px"),this.legend.selectAll("li").data(t).enter().append("li").style("background",function(t){return function(e){return t.color(e)}}(this)).html(function(t,e){return 0!==e?t:"&nbsp"})},n}(BaseGraph)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;window.MapGraph=function(i){function n(e,i){return this.setTooltipData=t(this.setTooltipData,this),this.onMouseOut=t(this.onMouseOut,this),this.onMouseMove=t(this.onMouseMove,this),this.onMouseOver=t(this.onMouseOver,this),this.getLegendFormat=t(this.getLegendFormat,this),this.getLegendData=t(this.getLegendData,this),this.setLegendPosition=t(this.setLegendPosition,this),this.setCountryColor=t(this.setCountryColor,this),n.__super__.constructor.call(this,e,i),this.formatFloat=d3.format(",.1f"),this.formatInteger=d3.format(",d"),this}return e(n,i),n.prototype.setSVG=function(){return n.__super__.setSVG.call(this),this.$tooltip=this.$el.find(".tooltip")},n.prototype.setScales=function(){return this.color=d3.scaleSequential(d3.interpolateOranges),this},n.prototype.loadData=function(t,e){return d3.queue().defer(d3.csv,t).defer(d3.json,e).await(function(t){return function(e,i,n){return t.$el.trigger("data-loaded"),t.setData(i,n)}}(this)),this},n.prototype.setData=function(t,e){return this.data=this.dataParser(t),this.setColorDomain(),this.options.legend&&this.drawLegend(),this.drawGraph(e),this},n.prototype.setColorDomain=function(){return this.color.domain([0,d3.max(this.data,function(t){return t.value})]),this},n.prototype.drawLegend=function(){var t,e;return t=30,e=this.getLegendData(),this.legend=this.container.append("g").attr("class","legend").call(this.setLegendPosition),this.legend.selectAll("rect").data(e).enter().append("rect").attr("x",function(i,n){return Math.round(t*(n-e.length/2))}).attr("width",t).attr("height",8).attr("fill",function(t){return function(e){return t.color(e)}}(this)),e.shift(),this.legend.selectAll("text").data(e).enter().append("text").attr("x",function(i,n){return Math.round(t*(n+.5-e.length/2))}).attr("y",20).attr("text-anchor","start").text(this.getLegendFormat)},n.prototype.drawGraph=function(t){return this.countries=topojson.feature(t,t.objects.countries),this.countries.features=this.countries.features.filter(function(t){return"010"!==t.id}),this.projection=d3.geoKavrayskiy7(),this.projectionSetSize(),this.path=d3.geoPath().projection(this.projection),this.container.selectAll(".country").data(this.countries.features).enter().append("path").attr("id",function(t){return"country-"+t.id}).attr("class",function(t){return"country"}).attr("fill",this.setCountryColor).attr("stroke-width",1).attr("stroke",this.setCountryColor).attr("d",this.path),this.$tooltip&&this.container.selectAll(".country").on("mouseover",this.onMouseOver).on("mousemove",this.onMouseMove).on("mouseout",this.onMouseOut),this.$el.trigger("draw-complete"),this},n.prototype.updateGraph=function(t){return this.data=this.dataParser(t),this.setColorDomain(),this.container.selectAll(".country").transition().attr("fill",this.setCountryColor).attr("stroke",this.setCountryColor)},n.prototype.updateGraphDimensions=function(){return n.__super__.updateGraphDimensions.call(this),this.projectionSetSize(),this.path.projection(this.projection),this.container.selectAll(".country").attr("d",this.path),this.options.legend&&this.legend.call(this.setLegendPosition),this},n.prototype.projectionSetSize=function(){return this.projection.fitSize([this.width,this.height],this.countries).scale(1.1*this.projection.scale()).translate([.48*this.width,.6*this.height])},n.prototype.setCountryColor=function(t){var e;return e=this.data.filter(function(e){return e.code_num===t.id}),e[0]?this.color(e[0].value):"#eee"},n.prototype.setLegendPosition=function(t){return t.attr("transform","translate("+Math.round(.5*this.width)+","+-this.options.margin.top+")")},n.prototype.getLegendData=function(){return d3.range(0,this.color.domain()[1])},n.prototype.getLegendFormat=function(t){return t},n.prototype.onMouseOver=function(t){var e,i;if(i=this.data.filter(function(e){return e.code_num===t.id}),i.length>0)return e=d3.mouse(d3.event.target),this.setTooltipData(i[0]),$(d3.event.target).offset(),this.$tooltip.css({left:e[0]-.5*this.$tooltip.width(),top:e[1]-.5*this.$tooltip.height(),opacity:"1"})},n.prototype.onMouseMove=function(t){var e;return e=d3.mouse(d3.event.target),this.$tooltip.css({left:e[0]-.5*this.$tooltip.width(),top:e[1]-.5*this.$tooltip.height()})},n.prototype.onMouseOut=function(t){return this.$tooltip.css("opacity","0")},n.prototype.setTooltipData=function(t){if(this.$tooltip.find(".tooltip-inner .title").html(t.name),this.$tooltip.find(".tooltip-inner .value").html(this.formatFloat(t.value)),t.cases)return this.$tooltip.find(".tooltip-inner .cases").html(this.formatInteger(t.cases))},n}(window.BaseGraph)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;window.ScatterplotGraph=function(i){function n(e,i){return this.setTooltipData=t(this.setTooltipData,this),this.onMouseOut=t(this.onMouseOut,this),this.onMouseOver=t(this.onMouseOver,this),this.onResize=t(this.onResize,this),this.setXAxisPosition=t(this.setXAxisPosition,this),this.setDotLabelsDimensions=t(this.setDotLabelsDimensions,this),this.setDotsDimensions=t(this.setDotsDimensions,this),this.getDotFill=t(this.getDotFill,this),this.getDotSize=t(this.getDotSize,this),this.getDotLabelText=t(this.getDotLabelText,this),this.getDotLabelId=t(this.getDotLabelId,this),this.getDotId=t(this.getDotId,this),this.getSizeDomain=t(this.getSizeDomain,this),this.getSizeRange=t(this.getSizeRange,this),this.getColorDomain=t(this.getColorDomain,this),this.getColorRange=t(this.getColorRange,this),this.getScaleYDomain=t(this.getScaleYDomain,this),this.getScaleXDomain=t(this.getScaleXDomain,this),i.dotSize=i.dotSize||7,i.dotMinSize=i.dotMinSize||7,i.dotMaxSize=i.dotMaxSize||12,n.__super__.constructor.call(this,e,i),this}return e(n,i),n.prototype.dataParser=function(t){return t.forEach(function(t){return function(e){return e[t.options.key.x]=+e[t.options.key.x],e[t.options.key.y]=+e[t.options.key.y]}}(this)),t},n.prototype.setSVG=function(){return n.__super__.setSVG.call(this),this.$tooltip=this.$el.find(".tooltip")},n.prototype.setScales=function(){return this.x=d3.scalePow().exponent(.25).range(this.getScaleXRange()),this.y=d3.scaleLinear().range(this.getScaleYRange()),this.options.key.color&&(this.color=d3.scaleOrdinal().range(this.getColorRange())),this.options.key.size&&(this.size=d3.scalePow().exponent(.5).range(this.getSizeRange())),this.xAxis=d3.axisBottom(this.x).tickSize(this.height),this.yAxis=d3.axisLeft(this.y).tickSize(this.width),this},n.prototype.getScaleXDomain=function(){return[0,d3.max(this.data,function(t){return function(e){return e[t.options.key.x]}}(this))]},n.prototype.getScaleYDomain=function(){return[0,d3.max(this.data,function(t){return function(e){return e[t.options.key.y]}}(this))]},n.prototype.getColorRange=function(){return["#C9AD4B","#BBD646","#63BA2D","#34A893","#3D91AD","#5B8ACB","#BA7DAF","#BF6B80","#F49D9D","#E25453","#B56631","#E2773B","#FFA951","#F4CA00"]},n.prototype.getColorDomain=function(){return d3.extent(this.data,function(t){return function(e){return e[t.options.key.color]}}(this))},n.prototype.getSizeRange=function(){return[this.options.dotMinSize,this.options.dotMaxSize]},n.prototype.getSizeDomain=function(){return[0,d3.max(this.data,function(t){return function(e){return e[t.options.key.size]}}(this))]},n.prototype.drawScales=function(){return n.__super__.drawScales.call(this),this.color&&this.color.domain(this.getColorDomain()),this.size&&this.size.domain(this.getSizeDomain()),this},n.prototype.drawGraph=function(){return this.container.selectAll(".dot").data(this.data).enter().append("circle").attr("class","dot").attr("id",this.getDotId).attr("r",this.getDotSize).style("fill",this.getDotFill).call(this.setDotsDimensions),this.container.selectAll(".dot-label").data(this.data).enter().append("text").attr("class","dot-label").attr("id",this.getDotLabelId).attr("dx","0.75em").attr("dy","0.375em").text(this.getDotLabelText).call(this.setDotLabelsDimensions),this.$tooltip&&this.container.selectAll(".dot").on("mouseover",this.onMouseOver).on("mouseout",this.onMouseOut),this},n.prototype.updateGraphDimensions=function(){return this.xAxis.tickSize(this.height),this.yAxis.tickSize(this.width),n.__super__.updateGraphDimensions.call(this),this.container.selectAll(".dot").call(this.setDotsDimensions),this.container.selectAll(".dot-label").call(this.setDotLabelsDimensions),this},n.prototype.getDotId=function(t){return"dot-"+t[this.options.key.id]},n.prototype.getDotLabelId=function(t){return"dot-label-"+t[this.options.key.id]},n.prototype.getDotLabelText=function(t){return t[this.options.key.id]},n.prototype.getDotSize=function(t){return this.size?this.size(t[this.options.key.size]):this.options.dotSize},n.prototype.getDotFill=function(t){return this.color?this.color(t[this.options.key.color]):null},n.prototype.setDotsDimensions=function(t){return t.attr("cx",function(t){return function(e){return t.x(e[t.options.key.x])}}(this)).attr("cy",function(t){return function(e){return t.y(e[t.options.key.y])}
}(this))},n.prototype.setDotLabelsDimensions=function(t){return t.attr("x",function(t){return function(e){return t.x(e[t.options.key.x])}}(this)).attr("y",function(t){return function(e){return t.y(e[t.options.key.y])}}(this))},n.prototype.setXAxisPosition=function(t){return t.attr("transform","translate(0,0)")},n.prototype.onResize=function(){return this.$el&&this.containerWidth!==this.$el.width()&&n.__super__.onResize.call(this),this},n.prototype.onMouseOver=function(t){var e;return e=d3.select(d3.event.target),this.setTooltipData(t),this.$tooltip.css({left:+e.attr("cx")+this.options.margin.left-.5*this.$tooltip.width(),top:+e.attr("cy")+this.options.margin.top-this.$tooltip.height()-15,opacity:1})},n.prototype.onMouseOut=function(t){return this.$tooltip.css("opacity","0")},n.prototype.setTooltipData=function(t){return this.$tooltip.find(".tooltip-inner .title").html(t[this.options.key.id]),this.$tooltip.find(".tooltip-inner .value-x").html(t[this.options.key.x]),this.$tooltip.find(".tooltip-inner .value-y").html(t[this.options.key.y])},n}(window.BaseGraph)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;window.ScatterplotDiscreteGraph=function(i){function n(e,i){return this.onMouseOut=t(this.onMouseOut,this),this.onMouseOver=t(this.onMouseOver,this),this.setDotLinesDimensions=t(this.setDotLinesDimensions,this),this.getScaleYDomain=t(this.getScaleYDomain,this),this.getDotLineId=t(this.getDotLineId,this),this.getDotLabelId=t(this.getDotLabelId,this),this.getDotId=t(this.getDotId,this),this.setXAxisPosition=t(this.setXAxisPosition,this),n.__super__.constructor.call(this,e,i),this}return e(n,i),n.prototype.dataParser=function(t){return t},n.prototype.setScales=function(){return this.x=d3.scaleLinear(),this.y=d3.scalePoint(),this.xAxis=d3.axisBottom(this.x),this.yAxis=d3.axisLeft(this.y),this},n.prototype.drawScales=function(){return this.y.domain(this.getScaleYDomain()),this.getDimensions(),this.svg.attr("height",this.containerHeight),this.x.range(this.getScaleXRange()),this.y.range(this.getScaleYRange()),this.options.key.color&&(this.color=d3.scaleOrdinal().range(this.getColorRange())),this.options.key.size&&(this.size=d3.scaleLinear().range(this.getSizeRange())),this.xAxis.tickSize(this.height),this.yAxis.tickSize(this.width),n.__super__.drawScales.call(this),this},n.prototype.drawGraph=function(){return n.__super__.drawGraph.call(this),this.container.selectAll(".dot-line").data(this.data).enter().append("line").attr("class","dot-line").attr("id",this.getDotLineId).style("stroke",this.getDotFill).call(this.setDotLinesDimensions),this.options.legend&&this.drawLegend(),this},n.prototype.drawLegend=function(){var t;return t=d3.nest().key(function(t){return t.vaccine}).entries(this.data),t.sort(function(t,e){return t.key>e.key?1:-1}),d3.select("#"+this.id+" .graph-legend ul").selectAll("li").data(t).enter().append("li").attr("id",function(t){return"legend-item-"+t.key}).style("background",function(t){return t.values[0].vaccine_color}).html(function(t){return t.values[0].vaccine_name}).on("mouseover",function(t){return function(e){return t.highlightVaccines(e.key)}}(this)).on("mouseout",this.onMouseOut)},n.prototype.getDimensions=function(){return this.$el&&(this.containerWidth=this.$el.width(),this.width=this.containerWidth-this.options.margin.left-this.options.margin.right,this.y&&(this.containerHeight=30*this.y.domain().length,this.height=this.containerHeight-this.options.margin.top-this.options.margin.bottom)),this},n.prototype.updateGraphDimensions=function(){return n.__super__.updateGraphDimensions.call(this),this.container.selectAll(".dot-line").call(this.setDotLinesDimensions),this},n.prototype.setXAxisPosition=function(t){return t.attr("transform","translate(0,0)")},n.prototype.getDotId=function(t){return"dot-"+t[this.options.key.id]+"-"+t[this.options.key.color]},n.prototype.getDotLabelId=function(t){return"dot-label-"+t[this.options.key.id]+"-"+t[this.options.key.color]},n.prototype.getDotLineId=function(t){return"dot-line-"+t[this.options.key.id]},n.prototype.getDotLabelText=function(t){return""},n.prototype.getScaleYDomain=function(){return this.data.map(function(t){return function(e){return e[t.options.key.y]}}(this))},n.prototype.setDotLinesDimensions=function(t){return t.attr("x1",function(t){return function(t){return 0}}()).attr("y1",function(t){return function(e){return t.y(e[t.options.key.y])}}(this)).attr("x2",function(t){return function(e){return t.x(e[t.options.key.x])}}(this)).attr("y2",function(t){return function(e){return t.y(e[t.options.key.y])}}(this))},n.prototype.onMouseOver=function(t){var e,i;return e=d3.select(d3.event.target),this.setTooltipData(t),i=this.options.legend?$("#"+this.id+" .graph-legend").height():0,this.$tooltip.css({left:+e.attr("cx")+this.options.margin.left-.5*this.$tooltip.width(),top:+e.attr("cy")+i+this.options.margin.top-this.$tooltip.height()-15,opacity:1}),this.highlightVaccines(d3.select(d3.event.target).data()[0][this.options.key.color])},n.prototype.onMouseOut=function(t){if(n.__super__.onMouseOut.call(this,t),this.container.selectAll(".dot").classed("inactive",!1).classed("active",!1),this.container.selectAll(".dot-line").classed("active",!1),this.options.legend)return d3.selectAll("#"+this.id+" .graph-legend li").classed("inactive",!1).classed("active",!1)},n.prototype.highlightVaccines=function(t){if(this.container.selectAll(".dot").classed("inactive",!0),this.container.selectAll(".dot").filter(function(e){return function(i){return i[e.options.key.color]===t}}(this)).classed("inactive",!1).classed("active",!0),this.container.selectAll(".dot-line").filter(function(e){return function(i){return i[e.options.key.color]===t}}(this)).classed("active",!0),this.container.selectAll(".dot").sort(function(e){return function(i,n){return i[e.options.key.color]===t?1:-1}}(this)),this.options.legend)return d3.selectAll("#"+this.id+" .graph-legend li").classed("inactive",!0),d3.selectAll("#"+this.id+" #legend-item-"+t).classed("inactive",!1).classed("active",!0)},n.prototype.setTooltipData=function(t){var e,i;return d3.format(".0s"),i=d3.format(",.1f"),this.$tooltip.find(".tooltip-inner .title").html(t.name),this.$tooltip.find(".tooltip-inner .vaccine").html(t.vaccine_name),this.$tooltip.find(".tooltip-inner .price").html(i(t.price)),e="",t.company&&(e=t.company,t.company2&&(e+=", "+t.company2),t.company3&&(e+=", "+t.company3)),this.$tooltip.find(".tooltip-inner .company").html(e)},n}(window.ScatterplotGraph)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;window.ScatterplotVPHGraph=function(i){function n(e,i,o){return this.setTooltipData=t(this.setTooltipData,this),this.getDotFill=t(this.getDotFill,this),this.getScaleYDomain=t(this.getScaleYDomain,this),this.getScaleXDomain=t(this.getScaleXDomain,this),o.dotSize=7,o.dotMinSize=3,o.dotMaxSize=18,this.lang=i,n.__super__.constructor.call(this,e,o),this}return e(n,i),n.prototype.setScales=function(){return this.x=d3.scalePow().exponent(.125).range(this.getScaleXRange()),this.y=d3.scaleLinear().range(this.getScaleYRange()),this.options.key.color&&(this.color=d3.scaleOrdinal().range(this.getColorRange())),this.options.key.size&&(this.size=d3.scalePow().exponent(.5).range(this.getSizeRange())),this.xAxis=d3.axisBottom(this.x).tickSize(this.height).tickValues([1024,4034,12474]),this.yAxis=d3.axisLeft(this.y).tickSize(this.width).tickValues([15,30,45,60,75,90]),this},n.prototype.getScaleXDomain=function(){return[250,102e3]},n.prototype.getScaleYDomain=function(){return[0,90]},n.prototype.getDotFill=function(t){return"1"===t[this.options.key.color]?"#00797d":"0"===t[this.options.key.color]?"#D64B05":"#aaa"},n.prototype.drawGraph=function(){return n.__super__.drawGraph.call(this),this.ringNote=d3.ringNote(),this.setAnnotations(),this.setXLegend(),this},n.prototype.setXLegend=function(){var t;return t=[this.x.domain()[0],1026,4036,12476,this.x.domain()[1]],this.$el.find(".x-legend li").each(function(e){return function(i,n){var o;return o=100*(e.x(t[i+1])-e.x(t[i]))/e.width,$(n).width(o+"%")}}(this))},n.prototype.setAnnotations=function(){var t;return t=[{cx:.23*this.height,cy:.17*this.height,r:.22*this.height,textWidth:.38*this.width,textOffset:[.25*this.height,0]},{cx:.28*this.height,cy:.46*this.height,r:.072*this.height,textWidth:.36*this.width,textOffset:[.18*this.height,0]},{cx:this.width-.35*this.height,cy:this.height-.12*this.height,r:.15*this.height,textWidth:.38*this.width,textOffset:[0,-.2*this.height]}],$("#vaccine-vph-container-graph .mobile-pictures p").each(function(e,i){return t[e].text=$(i).html()}),this.container.call(this.ringNote,t)},n.prototype.updateGraphDimensions=function(){return n.__super__.updateGraphDimensions.call(this),this.setAnnotations(),this},n.prototype.setTooltipData=function(t){var e;return e=d3.format(",.1f"),this.$tooltip.find(".vaccine span").css("display","none"),this.$tooltip.find(".vaccine-"+t[this.options.key.color]).css("display","inline"),this.$tooltip.find(".tooltip-inner .title").html(t[this.options.key.id]),this.$tooltip.find(".tooltip-inner .value-y").html(e(t[this.options.key.y]))},n}(window.ScatterplotGraph)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};window.VaccinesPrices=function(){function e(e,i,n){this.onDataLoaded=t(this.onDataLoaded,this),this.lang=e,d3.queue().defer(d3.csv,i+n).defer(d3.csv,i+"/data/gdp.csv").await(this.onDataLoaded)}return e.prototype.vaccines_names={es:{BCG:"Tuberculosis (BCG)",DTaP:"Difteria, tétanos y tos ferina acelular (DTaP)",DTP:"Difteria, tétanos y tos ferina (DTP)","DTPa-IPV-Hib":"Pentavalente (DTP, polio e Hib)","HepB-pediátrica":"Hepatitis B pediátrica",IPV:"Polio (IPV)",MMR:"Sarampión, paperas y rubeola",pneumo13:"Neumococo (13)",Tdap:"Tétanos, difteria y tos ferina acelular reducida (Tdap)",VPH:"Virus del papiloma humano (VPH)","VPH-Cervarix2":"VPH Cervarix2","VPH-Gardasil4":"VPH Gardasil4","VPH-Gardasil9":"VPH Gardasil9"},en:{BCG:"Tuberculosis (BCG)",DTaP:"Diphteria, tetanus and acellular pertussis (DTaP)",DTP:"Diphteria, tetanus and pertussis (DTP)","DTPa-IPV-Hib":"Pentavalent (DTP, polio and Hib)","HepB-pediátrica":"Hepatitis B pediatric",IPV:"Polio (IPV)",MMR:"Measles, mumps and rubella",pneumo13:"Pneumococcus (13)",Tdap:"Tetanus, reduced diphtheria and reduced acellular pertussis (Tdap)",VPH:"Human papilomavirus (HPV)","VPH-Cervarix2":"VPH Cervarix2","VPH-Gardasil4":"VPH Gardasil4","VPH-Gardasil9":"VPH Gardasil9"}},e.prototype.vaccines_colors={BCG:"#C9AD4B",DTaP:"#63BA2D",DTP:"#34A893","DTPa-IPV-Hib":"#BBD646","HepB-pediátrica":"#3D91AD",IPV:"#5B8ACB",MMR:"#E2773B",pneumo13:"#BA7DAF",Tdap:"#F49D9D","VPH-Cervarix2":"#FFA951","VPH-Gardasil4":"#B56631","VPH-Gardasil9":"#E25453"},e.prototype.onDataLoaded=function(t,e,i){var n,o,r,s,a;if(this.data=e,this.countries=i,this.parseData(),$("#vaccine-prices-all-graph").length>0&&this.setupScatterplot("vaccine-prices-all-graph",this.data,!0),$("#vaccine-prices-organizations-graph").length>0&&(o=this.data.filter(function(t){return"MSF"===t.country||"PAHO"===t.country||"UNICEF"===t.country}),this.setupScatterplot("vaccine-prices-organizations-graph",o,!0)),$("#vaccine-prices-tdap-graph").length>0&&(r=this.data.filter(function(t){return"Tdap"===t.vaccine}),this.setupScatterplot("vaccine-prices-tdap-graph",r,!1)),$("#vaccine-prices-ipv-graph").length>0&&(n=this.data.filter(function(t){return"IPV"===t.vaccine&&"MSF"!==t.country&&"PAHO"!==t.country&&"UNICEF"!==t.country}),this.setupScatterplot("vaccine-prices-ipv-graph",n,!1)),$("#vaccine-prices-vph-graph").length>0&&this.setupScatterplot("vaccine-prices-vph-graph",this.data,!0),$("#pib-countries-graph").length>0)return a=d3.nest().key(function(t){return t.country}).entries(this.data),a=a.map(function(t){return{id:t.key,name:t.values[0].name,gdp:.937*t.values[0].gdp}}),a=a.filter(function(t){return t.gdp>0}).sort(function(t,e){return e.gdp-t.gdp}),s=new window.BarGraph("pib-countries-graph",{label:{format:function(t){return d3.format(",d")(t)+"€"}},margin:{right:10,left:10},key:{x:"name",y:"gdp",id:"id"}}),s.setData(a),$(window).resize(s.onResize)},e.prototype.parseData=function(){var t;return t=["pneumo13","BCG","IPV","MMR","HepB-pediátrica","VPH-Cervarix2","VPH-Gardasil4","VPH-Gardasil9","DTPa-IPV-Hib","DTaP","Tdap","DTP"],this.data=this.data.filter(function(e){return t.indexOf(e.vaccine)!==-1}),this.data.forEach(function(t){return function(e){var i;return i=t.countries.filter(function(t){return t.code===e.country}),e.price=+e.price,e.vaccine_name=t.vaccines_names[t.lang][e.vaccine]?t.vaccines_names[t.lang][e.vaccine]:e.vaccine,e.vaccine_color=t.vaccines_colors[e.vaccine],i[0]?(e.name=e["name_"+t.lang],e.gdp=i[0].value):(e.name=e["name_"+t.lang],e.gdp=0)}}(this)),this.data.sort(function(t,e){return t.gdp-e.gdp})},e.prototype.setupScatterplot=function(t,e,i){var n;return n=new window.ScatterplotDiscreteGraph(t,{legend:i,margin:{top:5,right:5,left:60,bottom:20},key:{x:"price",y:"name",id:"country",color:"vaccine"}}),n.yAxis.tickPadding(12),n.xAxis.ticks(5).tickPadding(10).tickFormat(function(t){return t+"€"}),n.getDotFill=function(t){return t.vaccine_color},n.setData(e),$(window).resize(n.onResize)},e}()}.call(this),function(){!function(t){var e,i,n,o,r,s,a,c,l,h,u,p,d,f,g,y,m,v;if(s=t("body").data("lang"),e=t("body").data("baseurl"),i=["NIU","COK","TUV","NRU","PLW","VGB","MAF","SMR","GIB","TCA","LIE","MCO","SXM","FRO","MHL","MNP","ASM","KNA","GRL","CY","BMU","AND","DMA","IMN","ATG","SYC","VIR","ABW","FSM","TON","GRD","VCT","KIR","CUW","CHI","GUM","LCA","STP","WSM","VUT","NCL","PYF","BRB"],"es"===s&&d3.formatDefaultLocale({currency:["$",""],decimal:",",thousands:".",grouping:[3]}),n=d3.format(",.1f"),o=d3.format(",d"),t('[data-toggle="tooltip"]').tooltip(),r=function(t,e,i){var n;return n=t.filter(function(t){return t.code===e}),n?"es"===i?n[0].name_es:n[0].name_en:void 0},a=function(){return d3.csv(e+"/data/diseases-polio-cases-total.csv",function(e,i){var n,r,a,c,l,h,u,p;for(n={},r="es"===s?"casos":"cases",i.forEach(function(t){return n[t.year]=t.value}),h=Popcorn.HTMLYouTubeVideoElement("#video-map-polio"),h.src="https://www.youtube.com/embed/o-EzVOjnc6Q?controls=0&showinfo=0&hd=1",l=Popcorn(h),c=37,p=27/(c+1),a=0;a<c;)u=""+(1980+a),l.footnote({start:p*a,end:a<c-1?p*(a+1):p*(a+1)+1,text:u+'<br><span class="value">'+o(n[u])+" "+r+"</span>",target:"video-map-polio-description"}),a++;return h.addEventListener("ended",function(e){return t(".video-map-polio-cover").show(),t("#video-map-polio-description, #video-map-polio iframe").fadeTo(0,0),l.currentTime(0)}),t("#video-map-polio-play-btn").click(function(e){return e.preventDefault(),l.play(),t(".video-map-polio-cover").fadeOut(),t("#video-map-polio-description, #video-map-polio iframe").fadeTo(300,1)})})},p=function(){return d3.queue().defer(d3.csv,e+"/data/measles-cases-who-regions.csv").defer(d3.csv,e+"/data/countries-who-regions.csv").defer(d3.json,e+"/data/map-world-110.json").await(function(e,i,n,o){var r;return n.forEach(function(t){var e;if(e=i.filter(function(e){return e.region===t.region}),e.length>0)return t.value=1e5*e[0].cases,t.cases=e[0].cases_total,t.name=e[0]["name_"+s]}),r=new window.MapGraph("measles-world-map-graph",{aspectRatio:.5625,margin:{top:60,bottom:0},legend:!0}),r.setData(n,o),t(window).resize(r.onResize)})},c=function(e,i,n,o){var r;return i=i.filter(function(t){return n.indexOf(t.code)!==-1&&d3.values(t.values).length>0}).sort(function(t,e){return t.total-e.total}),r=new window.HeatmapGraph(e,{legend:o,margin:{right:0,left:0}}),r.setData(i),t(window).resize(r.onResize)},g=function(){return d3.csv(e+"/data/confidence.csv",function(e,i){return d3.json("https://freegeoip.net/json/",function(e,o){var r;return o||(o={},o.code="de"===s?"DEU":"ESP"),i.forEach(function(t){return function(t){if(t.value=+t.value,t.name="de"===s?t.name_en:t["name_"+s],delete t.name_es,delete t.name_en,o&&t.code===o.code)return t.active=!0}}()),r=new window.BarGraph("vaccine-confidence-graph",{aspectRatio:.3,label:{format:function(t){return n(t)+"%"}},margin:{top:0},key:{x:"name",y:"value",id:"code"}}),r.setData(i),t(window).resize(r.onResize)})})},d=function(){return d3.queue().defer(d3.csv,e+"/data/tuberculosis-cases.csv").defer(d3.csv,e+"/data/countries.csv").defer(d3.json,e+"/data/map-world-110.json").await(function(e,i,n,o){var r;return i.forEach(function(t){var e;if(e=n.filter(function(e){return e.code===t.code}),t.value=+t.cases_population,t.cases=+t.cases,e)return t.name=e[0]["name_"+s],t.code_num=e[0].code_num}),r=new window.MapGraph("vaccine-bcg-cases-graph",{aspectRatio:.5625,margin:{top:60,bottom:0},legend:!0}),r.getLegendData=function(){return[0,200,400,600,800]},r.setData(i,o),t(window).resize(r.onResize)})},f=function(){return d3.queue().defer(d3.csv,e+"/data/bcg-stockouts.csv").defer(d3.csv,e+"/data/countries.csv").defer(d3.json,e+"/data/map-world-110.json").await(function(e,i,n,o){var r,a;return a=d3.range(2006,2016),i.forEach(function(t){var e;if(e=n.filter(function(e){return e.code===t.code}),t.value=+t.value,t.years="",a.forEach(function(e){return"2"!==t[e]&&"3"!==t[e]||(t.years+=e+","),delete t[e]}),e)return t.name=e[0]["name_"+s],t.code_num=e[0].code_num}),r=new window.MapGraph("vaccine-bcg-stockouts",{aspectRatio:.5625,margin:{top:60,bottom:0},legend:!0}),r.formatFloat=r.formatInteger,r.getLegendData=function(){return[0,2,4,6,8]},r.setTooltipData=function(t){return r.$tooltip.find(".tooltip-inner .title").html(t.name),r.$tooltip.find(".description, .years-cells").hide(),0===t.value?r.$tooltip.find(".description-zero").show():1===t.value?(r.$tooltip.find(".description-one .value").html(t.years.split(",")[0]),r.$tooltip.find(".description-one").show()):(r.$tooltip.find(".description-multiple .value").html(r.formatInteger(t.value)),r.$tooltip.find(".years-cells li").toggleClass("active",!1),t.years.split(",").forEach(function(t){return r.$tooltip.find('.years-cells li[data-year="'+t+'"]').toggleClass("active",!0)}),r.$tooltip.find(".description-multiple, .years-cells").show())},r.setData(i,o),t(window).resize(r.onResize)})},y=function(){return d3.queue().defer(d3.csv,e+"/data/diseases-cases-measles.csv").defer(d3.csv,e+"/data/population.csv").await(function(t,e,i){return delete e.columns,e.forEach(function(t){var e,n,o;if(t.year_introduction&&(t.year_introduction=+t.year_introduction.replace("prior to","")),t.cases={},t.values={},t.name=r(i,t.code,s),n=i.filter(function(e){return e.code===t.code}),n.length>0)for(o=1980;o<2016;)t[o]&&0!==(e=+n[0][o])&&(t.cases[o]=+t[o],t.values[o]=1e5*+t[o]/e),delete t[o],o++;return t.total=d3.values(t.values).reduce(function(t,e){return t+e},0)}),c("vaccines-measles-graph-1",e,["FIN","HUN","PRT","URY","MEX","COL"],!0),c("vaccines-measles-graph-2",e,["IRQ","BGR","MNG","ZAF","FRA","GEO"],!1)})},l=function(){var i;return i=new window.LineGraph("immunization-coverage-graph-all",{key:{id:"code",x:"name"},label:!0,margin:{top:20}}),i.getScaleYDomain=function(t){return[0,100]},i.yAxis.tickValues([0,25,50,75,100]),d3.csv(e+"/data/immunization-coverage.csv",function(e,n){return i.setData(n.filter(function(e){return e.vaccine===t("#immunization-coverage-vaccine-selector").val()})),t("#immunization-coverage-vaccine-selector").change(function(e){return i.setData(n.filter(function(e){return e.vaccine===t("#immunization-coverage-vaccine-selector").val()})),t("#immunization-coverage-country-1-selector").trigger("change")}),t("#immunization-coverage-country-1-selector, #immunization-coverage-country-2-selector").change(function(e){return t("#immunization-coverage-graph-all").find(".line-label, .line").removeClass("active"),t("#immunization-coverage-graph-all #line-"+t("#immunization-coverage-country-1-selector").val()).addClass("active"),t("#immunization-coverage-graph-all #line-"+t("#immunization-coverage-country-2-selector").val()).addClass("active"),t("#immunization-coverage-graph-all #line-label-"+t("#immunization-coverage-country-1-selector").val()).addClass("active"),t("#immunization-coverage-graph-all #line-label-"+t("#immunization-coverage-country-2-selector").val()).addClass("active")}),t("#immunization-coverage-country-1-selector").trigger("change")}),t(window).resize(i.onResize)},h=function(){var i,n;return i=["LKA","DZA","DEU","DNK","FRA"],n=[],d3.queue().defer(d3.csv,e+"/data/immunization-coverage-mcv2.csv").defer(d3.csv,e+"/data/countries.csv").await(function(e,o,r){return d3.json("https://freegeoip.net/json/",function(e,a){var c,l;return a&&(l=r.filter(function(t){return t.code2===a.country_code}))&&l.length>0&&l[0].code&&i.indexOf(l[0].code)===-1&&(i[2]=l[0].code,c=t("#immunization-coverage-graph .graph-container").eq(2),c.find("p").html(l[0]["name_"+s]),c.find(".line-graph").attr("id","immunization-coverage-"+l[0].code.toLowerCase()+"-graph")),i.forEach(function(e,i){var r,a;return r=o.filter(function(t){return t.code===e}).map(function(e){return t.extend({},e)}),r.forEach(function(t){return delete t[2001],delete t[2002]}),a=new window.LineGraph("immunization-coverage-"+e.toLowerCase()+"-graph",{isArea:!0,key:{x:"name",id:"code"}}),n.push(a),a.yFormat=function(t){return t+"%"},a.getScaleYDomain=function(t){return[0,100]},a.yAxis.tickValues([50]),a.xAxis.tickValues([2003,2015]),a.addMarker({value:95,label:i%2!=0?"":"es"===s?"Nivel de rebaño":"de"===s?"Herdenimmunität":"Herd immunity",align:"left"}),a.$el.on("draw-complete",function(t){return a.setLabel(2015),a.container.select(".x.axis").selectAll(".tick").style("display","block"),a.container.select(".tick-hover").style("display","none")}),a.setData(r),a.$el.on("change-year",function(t,e){return n.forEach(function(t){if(t!==a)return t.setLabel(e)})}),a.$el.on("mouseout",function(t){return n.forEach(function(t){if(t!==a)return t.hideLabel()})}),t(window).resize(a.onResize)})})})},v=function(){var i,n;return i=["diphteria","measles","pertussis","polio","tetanus"],n=[],d3.csv(e+"/data/diseases-cases-world.csv",function(e,o){var r,s;return r=d3.max(o,function(t){return d3.max(d3.values(t),function(t){return+t})}),s=1e5,i.forEach(function(e){var i,a;return i=o.filter(function(t){return t.disease===e}).map(function(e){return t.extend({},e)}),a=new window.LineGraph(e+"-world-graph",{isArea:!0,margin:{left:20},key:{x:"disease",id:"disease"}}),n.push(a),a.xAxis.tickValues([1980,2015]),a.yAxis.ticks(2).tickFormat(d3.format(".0s")),a.yFormat=d3.format(".2s"),a.getScaleYDomain=function(){return[0,"measles"===e||"pertussis"===e?r:s]},a.setData(i),a.$el.on("change-year",function(t,e){return n.forEach(function(t){if(t!==a)return t.setLabel(e)})}),a.$el.on("mouseout",function(t){return n.forEach(function(t){if(t!==a)return t.hideLabel()})}),t(window).resize(a.onResize)})})},u=function(){return d3.queue().defer(d3.csv,e+"/data/immunization-coverage.csv").defer(d3.csv,e+"/data/countries.csv").await(function(e,n,o){return d3.json("https://freegeoip.net/json/",function(e,a){var c,l,h,u;return a?(u=o.filter(function(t){return t.code2===a.country_code}),a.code=u[0].code,a.name=u[0]["name_"+s]):(a={},"de"===s?(a.code="DEU",a.name="Germany"):(a.code="ESP",a.name="es"===s?"España":"Spain")),h={MCV1:95,Pol3:80,DTP3:80},n=n.filter(function(t){return i.indexOf(t.code)===-1}),c=function(t){var e;return e={key:t.code,name:r(o,t.code,s),value:+t[2015]},a&&t.code===a.code&&(e.active=!0),e},l=function(t,e){return e.value-t.value},t(".immunization-coverage-disease-graph").each(function(){var e,i,o,r,u,p,d;return e=t(this),i=e.data("disease"),d=e.data("vaccine"),r=n.filter(function(t){return t.vaccine===d&&""!==t[2015]}).map(c).sort(l),a&&(u=r.filter(function(t){return t.key===a.code})),o=new window.BarGraph(i+"-immunization-bar-graph",{aspectRatio:.25,label:{format:function(t){return+t+"%"}},key:{x:"name"},margin:{top:20}}),p={value:h[d],label:"es"===s?"Nivel de rebaño":"de"===s?"Herdenimmunität":"Herd immunity"},"DTP3"===d&&(p.label="es"===s?"Recomendación OMS":"WHO recommendation"),o.addMarker(p).setData(r),u&&u.length>0&&(e.find(".immunization-country").html(a.name),e.find(".immunization-data").html("<strong>"+u[0].value+"%</strong>"),e.find(".immunization-description").show()),t(window).resize(function(){return o.onResize()})})})})},m=function(){return d3.queue().defer(d3.csv,e+"/data/vph.csv").defer(d3.csv,e+"/data/gdp.csv").await(function(e,n,o){var r;return n=n.filter(function(t){return i.indexOf(t.country)===-1}),n.forEach(function(t){var e;return e=o.filter(function(e){return e.code===t.country}),e[0]&&(t.name=e[0]["name_"+s],t.gdp=+e[0].value),t.value=+t.deaths}),n=n.filter(function(t){return t.gdp}),r=new window.ScatterplotVPHGraph("vaccine-vph-graph",s,{margin:{left:20,top:30,bottom:0},key:{x:"gdp",y:"value",id:"name",color:"vaccine"}}),r.setData(n),t(window).resize(r.onResize)})},t("#video-map-polio").length>0&&a(),t(".vaccines-disease-graph").length>0&&y(),t("#immunization-coverage-graph-all").length>0&&l(),t("#immunization-coverage-graph").length>0&&h(),t("#world-cases").length>0&&v(),t(".immunization-coverage-disease-graph").length>0&&u(),t("#measles-world-map-graph").length>0&&p(),t("#vaccine-confidence-graph").length>0&&g(),t("#vaccine-bcg-cases-graph").length>0&&d(),t("#vaccine-bcg-stockouts").length>0&&f(),t("#vaccine-vph-graph").length>0&&m(),(t("body").hasClass("prices")||t("body").hasClass("precios"))&&new VaccinesPrices(s,e,"/data/prices-vaccines.csv"),t("#vaccine-prices-vph-graph").length>0)new VaccinesPrices(s,e,"/data/prices-vaccines-vph.csv")}(jQuery)}.call(this);